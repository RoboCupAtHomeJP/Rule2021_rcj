# Tidy Up for OPL（概要版）

- 本タスクは部屋の片付けを通じて，物体認識と物体把持にフォーカスする
- 本競技のルールは，[World Robot Summit 2020](https://worldrobotsummit.org/) の World Robot Challenge の競技の一つ，Tidy Upのカスタマイズ版である

## お知らせ

- このドキュメントは**タスク内容の理解を助ける概要版**です．正式なルールは[こちら](tidyup_opl_ja.md)をご覧ください
  - ドキュメントの準備には注意しておりますが，もし概要版と正式ルール版で矛盾がある場合，正式ルール版が適用されます

## Focus

- セマンティックマッピング
- 未知物体認識
- 物体把持
- パスプランニング
- HRI

## Task

このタスクは大きくTask 1とTask 2に分けられ，Task 2はさらにTask 2aとTask 2bに分けられる

### Task 1

Task 1は15分間である．Task 1はリビングルームを模した部屋（Room 1 : Living Room）で行われる．Task 1では，ロボットはテーブル（Long Table B）の上（＝ Search Area）に並べられた物体の片付けを行う．テーブルには5つの物体が置かれ，そのうち4つがKnown object，1つがUnknown objectである．Unknown objectを含む全てのKnown objectには「Food items」「Kitchen items」「Task items」の中から1つの物体クラス（Category）が割り当てられている．それぞれのクラスには次のように収納場所が定義されている．正しい場所へ収納すると，得点が得られる

| 物体クラス（Category） | 収納場所（Deposit）                              |
| ---------------------- | ------------------------------------------------ |
| Food items             | Tray A または Tray B（どちらも Long Table A 上） |
| Kitchen items          | Container A（Long Table A上）                    |
| Task items             | Bin A                                            |
| Unknown object         | Bin B または，正しい Category の収納場所         |

このタスクでは，次の点数計算が行われる

- 物体を把持し，収納場所まで運搬した場合（Delivery）：10点
- 物体を運搬した収納場所が合っていた場合（Category）：＋10点
- 物体を把持したが，物体を落とした場合
  - その後，次に同じ物体を把持した場合：ペナルティはない
  - その後，次に別の物体を把持した場合（Drop）：Dropのペナルティが課せられ，運搬した物体の点数がx0.5となる．なお，1つの物体を運搬するまでに複数回物体を落とした場合でも，Dropのペナルティは1度のみである
- ロボットが物体と接触した場合
  - ロボットのハンドが，物体に接触した場合（把持のために接触した場合を想定）：ペナルティはない
  - ロボットのハンド以外の部分が物体に接触した場合（Hit）：Hitのペナルティが課せられ，運搬した物体の点数がx0.5となる．なお，1つの物体を運搬するまでに複数回物体に接触した場合でも，Hitのペナルティは1度のみである

またTask 1では，時間内であれば無制限にリスタートを繰り返すことができる．リスタート時，ロボットが持っている物体を持たせたままにするか，取り上げるかはチームが選択して良い．ただし取り上げた物体は，その後アリーナの外で保管すること．このTask中で取り上げた物体は使われない．

- リスタート後，最初の物体の運搬時にペナルティが課せられる（Restart）：x0.5

さらにボーナスとして次の得点が得られる

- 14分45秒までにすべての物体を正しい場所に収納した場合，ボーナスで50点（Finishing the task within the time limit (15 min - 15 sec): 50 points）

### Task 2

Task 2は5分間である．Task 2はさらにTask 2aとTask 2bを内包している．

#### Task 2a

ロボットは一方の部屋（Room 1 : Living room）からもう一方の部屋（Room 2 : Dining Room）へ移動する．この時に通過する空間（Obstacle Avoidance Area）には3つのKnown objectが置かれている．ロボットはこの物体を避けながら移動する必要がある．

このタスクでは，次の点数計算が行われる

- 1度も物体と接触せず，部屋間を移動できた場合（Successfully entering to the dining room to the goal location and without collisions）：100点

1度でもObstacle Avoidance Areaの物体に接触すると，Task 2aの得点はない．例えば，1度物体に接触した後に，Task 2bでリスタートを実施して，その結果Obstacle Avoidance Areaを物体と接触することなく通過したとしても，100点は獲得できない

#### Task 2b

ロボットは，棚（Food Area）に並ぶ物体から事前に指示された物体の1つを正しく見つけ，それを2つのイス（Delivery Area）に座る人のうち，手を振っている人に渡す．Food Areaには2つのKnown objectと1つのUnknown objectが置かれる．Food Areaに置かれる3つの物体はFood itemsに限定されない．また，お互いに別の物体を隠すように置かれることはない

このタスクでは，次の点数計算が行われる

##### Task 2b1（物体を把持するまで）

- Food Areaに置かれる物体のうち1つを把持した場合（Taking any food item in the shelf）：40点
- 把持した物体が正しいものである場合（Taking the requested object among many objects in the shelf）：＋60点
- ロボットが物体と接触した場合
  - ロボットのハンドが，物体に接触した場合（把持のために接触した場合を想定）：ペナルティはない
  - ロボットのハンド以外の部分が物体に接触した場合：Hitのペナルティが課せられる．このペナルティは最大4回である．次の計算式でTask2b1の計算が行われる
    - Task2b1の得点＝（1 - 0.25×接触回数）×（「Food Areaに置かれる物体のうち1つを把持した場合」の点数＋「把持した物体が正しいものである場合」の点数）

##### Task 2b2（物体を届けるまで）

- Delivery Areaの人へ物体を届けることができた場合（Delivering the object to a person in the delivery area）：40点
- 届け先の人が正しい人（手を振っていた人）である場合（Taking the requested object among many objects in the shelf）：＋60点
- ロボットが物体と接触した場合
  - ロボットのハンドが，物体に接触した場合（把持のために接触した場合を想定）：ペナルティはない
  - ロボットのハンド以外の部分が物体に接触した場合：Hitのペナルティが課せられる．このペナルティは最大4回である．次の計算式でTask2b2の計算が行われる
    - Task2b2の得点＝（1 - 0.25×接触回数）×（「Delivery Areaの人へ物体を届けることができた場合」の点数＋「届け先の人が正しい人（手を振っていた人）である場合」の点数）

Task 2bについて，リスタートは可能である．Task 2bでリスタートした場合，特に得点に関するペナルティはない．ただしタイマーは停止せず，カウントダウンを継続する．またリスタートの際，棚の物体を並べ替えることは禁止される．ロボットが物体を把持していた場合，そのままロボットに持たせるか，ロボットから物体を取り上げるかはチームが選択して良い

Task 2について，さらにボーナスとして次の得点が得られる

- 5分45秒までにTask2が300点を獲得した場合（Finishing the task within the time limit (5 min - 15 sec)）：50点
- 上記を満たしている場合，さらに1分につき20点（If any time remaining, add 20 points per minute）



## Bypassing

このタスクにはバイパスルールが適用される

### 把持に関するバイパス

アームを搭載していないロボットや，アームを制御できないロボットが出場する場合において，物体把持が求められる状況に直面した時，それ以上タスクを遂行することができない．バイパスルールとは，競技会で可能な限りロボットのパフォーマンスを披露するため，ロボットがアーム制御までのタスクを達成した場合，アーム制御のみをスキップする（バイパスする）ルールである．このルールでは，物体を正確に認識できたことを明示的にレフェリーに示すことができた場合，バイパスルールを適用することで，ロボットがアームを制御する代わりに，レフェリーやオペレーターが物体を把持して，ロボットはタスクを続行することができる．但し，バイパスルールを適用した場合，物体把持に関する得点は加算されない．

- Task 1

  - ロボットが物体を把持できない場合，ロボットが明瞭に，かつ正確に物体の場所（「ロボットから見て真正面にある」「テーブルの右からN個目」等）と名前を伝えることが出来る場合，ロボットは把持をバイパスすることができる．ロボットは，例えば，物体を指して，あるいは明確に対象物体の方向を向いて「目の前にある○○という物体を私に乗せてくれ」等と伝えなければならない．この指示が誤っていた場合，レフェリーはロボットを手伝うことができない．

    - この場合，Deliveryの点数は0点である

  - またロボットが物体を設置できない場合，ロボットが明らかに物体を収納する場所に来て「私が持っている○○という物体を，目の前のXXへ収納してくれ」等と伝えた場合，レフェリーはロボットを手伝う．すなわち，レフェリーが物体設置時にロボットを手伝うには，下記の条件を満たしている必要がある

    - ロボットが，自分が持っている物体の名前を正しく言う
    - ロボットが，収納して欲しい場所の名前を言う
    - ロボットが，明らかに，上述した「収納して欲しい場所」の前にいる

    これらの条件を満たしたとき，レフェリーはロボットを手伝う．その結果，正しい場所に正しい物体が収納された場合，Categoryの点数が加点される

- Task 2b

  - ロボットが物体を把持できない場合，ロボットが明瞭に，かつ正確に物体の場所（「ロボットから見て真正面にある」「テーブルの右からN個目」等）と名前を伝えることが出来る場合，ロボットは把持をバイパスすることができる．ロボットは，例えば，物体を指示棒などで指して，あるいは明確に対象物体の方向を向いて「目の前にある○○という物体を私に乗せてくれ」等と伝えなければならない．この指示が誤っていた場合，レフェリーはロボットを手伝うことができない．

    - この場合，Taking any food item in the shelfの点数は0点である
    - 同様に，Taking the requested object among many objects in the shelfの点数も0点である

  - ロボットがDelivery Areaで人に物体を渡す際，ロボットが物体を把持できない場合，下記条件を満たしているならばDelivery Areaの人はレフェリーによりロボット上の特定の場所に置かれた物体を，渡されることなく受け取ることができる

    - ロボットが明らかに，人の前にいる
    - ロボットが「私の○○に載っている物体を受け取ってくれ」と伝え，その場所に物体が載っている

    その結果，正しい人物が正しい物体を持つことが出来た場合，次の点数計算が行われる

    - Delivering the object to a person in the delivery areaの点数は0点である（ロボット単独でDelivery出来ていないため）
    - Correctly detecting a person’s request and giving the item to her/himの点数60点が加点される